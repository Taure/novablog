%% -*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -*-

[
 {kernel, [
           {logger_level, debug},
           {logger, [
             {handler, default, logger_std_h,
               #{formatter => {flatlog, #{
                                          map_depth => 3,
                                          term_depth => 50,
                                          colored => true,
                                          template => [colored_start, "[\033[1m", level, "\033[0m", colored_start,"] [", time, "]",
                                                       colored_end, " ", msg, " (", mfa, ")\n"]
                                         }}}}
           ]}
          ]},
 {nova, [
         {use_stacktrace, true},
         {environment, dev},
         {cowboy_configuration, #{
                                  port => 8080,
                                  stream_handlers => [cowboy_metrics_h, nova_stream_h,
                                                      cowboy_compress_h, cowboy_stream_h],
                                  options => #{
                                      compress => true,
                                      metrics_callback => fun my_first_nova_metrics:record/1
                                  }
                                 }},
         {dev_mode, true},
         {bootstrap_application, my_first_nova}, %% Bootstraps the application
         %% Plugins is written on form {RequestType, Module, Options, Priority}
         %% Priority is that the lowest number is executed first
         {plugins, [
                    {pre_request, nova_request_plugin, #{decode_json_body => true,
                                                          read_urlencoded_body => true}},
                    {pre_request, my_first_nova_metrics_plugin, #{}}
                   ]}
        ]}
 },
 {my_first_nova, [
    {database, <<"my_first_nova_dev">>}
 ]}
].
